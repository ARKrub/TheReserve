<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Excel Data Filter</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="p-6 max-w-5xl mx-auto">
  <h1 class="text-2xl font-bold mb-4">Excel Data Filter</h1>  <input type="file" id="fileUpload" accept=".xlsx, .xls" class="mb-4" />  <div id="filters" class="mt-6 hidden">
    <label class="block font-semibold">Select Year:</label>
    <select id="yearSelect" class="border p-2 rounded mb-4"></select><div id="columnCheckboxes" class="grid grid-cols-2 gap-4 mb-4"></div>

<div class="mt-6">
  <h2 class="text-xl font-bold mb-2">Filtered Results</h2>
  <table id="resultsTable" class="w-full border text-sm"></table>
</div>

  </div>  <script>
    let data = [];
    let columns = [];
    let filters = {};
    let displayColumns = [];

    document.getElementById('fileUpload').addEventListener('change', handleFileUpload);

    function handleFileUpload(e) {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = (evt) => {
        const bstr = evt.target.result;
        const wb = XLSX.read(bstr, { type: "binary" });
        const wsname = wb.SheetNames[0];
        const ws = wb.Sheets[wsname];
        data = XLSX.utils.sheet_to_json(ws);

        if (data.length === 0) return;

        columns = Object.keys(data[0]).filter(c => c !== 'Year');
        displayColumns = [...columns];
        setupYearSelect();
        setupCheckboxes();
        applyFilters();
        document.getElementById('filters').classList.remove('hidden');
      };
      reader.readAsBinaryString(file);
    }

    function uniqueValues(col) {
      return [...new Set(data.map((row) => row[col]))].filter(v => v !== undefined && v !== null);
    }

    function setupYearSelect() {
      const yearSelect = document.getElementById('yearSelect');
      yearSelect.innerHTML = '<option value="">All</option>' + uniqueValues('Year').map(y => `<option value="${y}">${y}</option>`).join('');
      yearSelect.onchange = () => {
        filters['Year'] = yearSelect.value;
        applyFilters();
      };
    }

    function setupCheckboxes() {
      const container = document.getElementById('columnCheckboxes');
      container.innerHTML = '';
      columns.forEach(col => {
        const id = `checkbox-${col}`;
        const wrapper = document.createElement('div');
        wrapper.innerHTML = `
          <label class="inline-flex items-center">
            <input type="checkbox" id="${id}" checked class="mr-2">
            ${col}
          </label>
        `;
        container.appendChild(wrapper);
        document.getElementById(id).onchange = () => {
          displayColumns = columns.filter(c => document.getElementById(`checkbox-${c}`).checked);
          applyFilters();
        };
      });
    }

    function applyFilters() {
      const resultsTable = document.getElementById('resultsTable');
      resultsTable.innerHTML = '';

      if(displayColumns.length === 0) return;

      const header = `<tr>${displayColumns.map(c => `<th class="border p-2">${c}</th>`).join('')}</tr>`;
      resultsTable.innerHTML += header;

      const filtered = data.filter(row => {
        if(filters['Year'] && row['Year'] != filters['Year']) return false;
        return true;
      });

      filtered.forEach(row => {
        const tr = `<tr>${displayColumns.map(c => `<td class="border p-2">${row[c] || ''}</td>`).join('')}</tr>`;
        resultsTable.innerHTML += tr;
      });
    }
  </script></body>
</html>
